{% extends 'base.html.twig' %}

{% block title %}Authentification 2FA.NET2ALL{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        ::-webkit-input-placeholder {
            text-align: center;
            color:#edeef0;
        }
        :-moz-placeholder {
            text-align: center;
            color:#edeef0;
        }
        .input-margin{
            margin: 5px;
        }
        input{
            height: 55px;
            border-radius: 3px;
            outline: none;
            background-color:#f4f5f7;
            border:none;
            font-size:28px;
            text-align: center;
            font-weight:bold;
            width: 1.8em;
            font-family: monospace;
        }
    </style>
{% endblock %}
{% block body %}
    <!-- start: page -->
    <section class="body-sign" >
        <div class="center-sign">

            <div class="panel panel-sign">
                <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;">
                    <a style="font-size: 22px;text-align: center;text-decoration: none;" href="javascript:void(0);">Authentification 2FA<b></b></a>
                    <small > <h6>Générer un code secret à 4 chiffres</h6></small>
                </div>
                <div class="panel-body">
                    {{ form_start(form) }}
                    {{ form_row(form._token) }}
                    <div style="color:red;font-weight: bold;">
                        {{ form_errors(form) }}
                    </div>
                    <div style="display: flex;flex-direction: row;justify-content: center;align-items: center;">
                        <div class="input-margin">
                            <div class="flex flex-row">
                                {{ form_widget(form.one)}}
                            </div>
                        </div>
                        <div class="input-margin">
                            <div class="flex flex-row">
                                {{ form_widget(form.two)}}
                            </div>
                        </div>
                        <div class="input-margin">
                            <div class="flex flex-row">
                                {{ form_widget(form.three)}}
                            </div>
                        </div>
                        <div class="input-margin">
                            <div class="flex flex-row">
                                {{ form_widget(form.four)}}
                            </div>
                        </div>
                    </div>
                    {{ form_end(form,{render_rest:false}) }}
                </div>
            </div>
            <p class="text-center text-muted mt-md mb-md">&copy; Copyright 2022. All rights reserved. Powered by <a href="https://net2all.online/">Net2All</a>.</p>
        </div>
    </section>
    <!-- end: page -->
{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script type="text/javascript">
        $(document).ready(function(){
            let padInput =  $(".input_pad");
            let padNumber =  padInput.length;
            $('.input_pad:not(.no-disabled)').prop('disabled',true);
            padInput.on('keyup', function (event) {
                if (/\D/g.test(this.value)) {
                    this.value =  this.value.replace(/\D/g, '').substring(0,1);
                }else if(this.value.trim().length > 0){
                    let index = parseInt($(this).attr('data-index'));
                    if(index < padNumber){
                        let currentPad = $('.pad_' + (index + 1));
                        currentPad.prop('disabled',false).focus();
                    }
                    if(index === padNumber){
                        $('#glass').css('display','block');
                        $(this).closest('form').submit();
                    }
                }else{return false;}
            });
            padInput.on('focus', function (event) {
                $(this).val('');
                let index = parseInt($(this).attr('data-index'));
                let extract = index - padNumber;
                while (extract < 0){
                    let currentPad = $('.pad_' + (extract + padNumber + 1) );
                    if(currentPad !== undefined){
                        currentPad.val('');
                        currentPad.prop('disabled',true);
                    }
                    extract++;
                }
            });
        });
    </script>
{% endblock %}
